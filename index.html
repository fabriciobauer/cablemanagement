<!DOCTYPE html>
<html>

<body>
    <img src="https://static.wixstatic.com/media/592d40_b71853c680b44fd88be8acdb9b684757~mv2.png/v1/fill/w_251,h_69,al_c,q_85,usm_0.66_1.00_0.01,enc_auto/logo%20magnani.png" alt="Logo da Empresa">
    <meta charset="UTF-8">
    <title>Catalogar Cabos</title>
    <style>

        table {
            border-collapse: collapse;
            width: 100%;
        }
        
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
        
        th {
            background-color: #f2f2f2;
        }
        
        tr:hover {
            background-color: #f5f5f5;
        }
        
        .button {
            display: inline-block;
            padding: 8px 12px;
            font-size: 14px;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
            outline: none;
            color: #fff;
            background-color: #ff0000;
            border: none;
            border-radius: 5px;
            box-shadow: 0 4px #999;
        }
        
        .button:hover {
            background-color: #ff0000;
        }
        
        .button:active {
            background-color: #ff0000;
            box-shadow: 0 2px #666;
            transform: translateY(4px);
        }
    </style>
</head>
<body>
    <h2>RETALHOS DE CABOS</h2>
    <form id="cableForm">
        <label for="cableType">Bitola do Cabo:</label>
        <input type="text" id="cableType" required>
        <br><br>
        <label for="cableSize">Tamanho do Cabo:</label>
        <input type="text" id="cableSize" required>
        <br><br>
        <label for="shelfAddress">Cor:</label>
        <input type="text" id="shelfAddress" required>
        <br><br>
        <input type="submit" value="Adicionar Cabo" class="button">
    </form>
    <br>
    <label for="search">Buscar Cabo:</label>
   
    <input type="text" id="search" onkeyup="searchCable2()"> 
    <br><br>
    <table id="cableTable">
        <tr>
            <th>Bitola do Cabo</th>
            <th>Tamanho do Cabo</th>
            <th>Cor</th>
            <th>Ação</th>
        </tr>
    </table>

    <script>
        // Array para armazenar os cabos
        let cables = [];

        // Carregar cabos do armazenamento local, se existirem
        if (localStorage.getItem("cables")) {
            cables = JSON.parse(localStorage.getItem("cables"));
            displayCables();
        }

        // Função para adicionar um cabo
        function addCable() {
            event.preventDefault(); // Impede que o formulário seja enviado
            let cableType = document.getElementById("cableType").value;
            let cableSize = document.getElementById("cableSize").value;
            let shelfAddress = document.getElementById("shelfAddress").value;

            cables.push({ type: cableType, size: cableSize, shelf: shelfAddress });

            // Limpa os campos do formulário
            document.getElementById("cableType").value = "";
            document.getElementById("cableSize").value = "";
            document.getElementById("shelfAddress").value = "";

            displayCables();
            saveCables();
        }

        function addCable2() {
            event.preventDefault(); // Impede que o formulário seja enviado
            let cableType = document.getElementById("cableType").value;
            let cableSize = document.getElementById("cableSize").value;
            let shelfAddress = document.getElementById("shelfAddress").value;

            let biggestId = 0
            for (let i = 0; i < cables.length; i++) {
                let currentId = Number(cables[i].id) // GIO: Voce vai notar que eu salvei o ID como string. Poderia ser number direto, teria sido mais facil, mas sei la. Arruma ai xD. Por ter salvo como string, aqui eu converti pra number pra poder calcular mais facil

                if (currentId > biggestId) {
                    biggestId = currentId
                }
            }

            cables.push({ id: String(biggestId + 1), type: cableType, size: cableSize, shelf: shelfAddress });

            // Limpa os campos do formulário
            document.getElementById("cableType").value = "";
            document.getElementById("cableSize").value = "";
            document.getElementById("shelfAddress").value = "";

            displayCables();
            saveCables();
        }

        // Função para exibir os cabos na tabela
        function displayCables() {
            let table = document.getElementById("cableTable");
            table.innerHTML = `
                <tr>
                    <th>Cabo</th>
                    <th>Tamanho do Cabo (metros)</th>
                    <th>Cor</th>
                    <th>Ação</th>
                </tr>
            `;

            cables.forEach(function(cable, index) {
                let row = table.insertRow(-1);
                row.id = cable.id // GIO: Adicionando o ID, inspenciona o elemento na tabela pra voce ver, cada td vai ter um id.
                let cableTypeCell = row.insertCell(0);
                let cableSizeCell = row.insertCell(1);
                let shelfAddressCell = row.insertCell(2);
                let actionCell = row.insertCell(3);

                cableTypeCell.innerHTML = cable.type;
                cableSizeCell.innerHTML = cable.size;
                shelfAddressCell.innerHTML = cable.shelf;

                let editButton = document.createElement("button");
                editButton.innerHTML = "Editar";
                editButton.className = "button";
               
                editButton.addEventListener("click", function() {
                    editCable2(editButton);
                });
                actionCell.appendChild(editButton);

                let deleteButton = document.createElement("button");
                deleteButton.innerHTML = "Excluir";
                deleteButton.className = "button";
              
                deleteButton.addEventListener("click", function() {
                    deleteCable2(deleteButton);
                });
                actionCell.appendChild(deleteButton);
            });
        }

        // Função para editar um cabo
        function editCable(index) {
            let cable = cables[index];
            let cableType = prompt("Digite o novo tipo de cabo:", cable.type);
            let cableSize = prompt("Digite o novo tamanho do cabo:", cable.size);
            let shelfAddress = prompt("Digite o nova cor:", cable.shelf);

            if (cableType !== null && cableSize !== null && shelfAddress !== null) {
                cables[index] = { type: cableType, size: cableSize, shelf: shelfAddress };
                displayCables();
                saveCables();
            }
        }

        function editCable2(element) {
            
            let cableId = String(element.closest("tr").id) // GIO: Note a conversao para string
            let cableIndex = cables.findIndex(cable => cable.id == cableId) // GIO: Procure findIndex.
            let cable = cables[cableIndex]

            let cableType = prompt("Digite o novo tipo de cabo:", cable.type);
            let cableSize = prompt("Digite o novo tamanho do cabo:", cable.size);
            let shelfAddress = prompt("Digite o novo endereço de prateleira:", cable.shelf);

            if (cableType !== null && cableSize !== null && shelfAddress !== null) {
                cables[cableIndex] = { id: cableId, type: cableType, size: cableSize, shelf: shelfAddress };
                displayCables();
                saveCables();
            }
        }

        // Função para excluir um cabo
        function deleteCable(index) {
            cables.splice(index, 1);
            displayCables();
            saveCables();
        }

        function deleteCable2(element) {
            let cableId = element.closest("tr").id
            cables = cables.filter(cable => cable.id != cableId)
            displayCables();
            saveCables();
        }
      
        // Função para buscar um cabo
        function searchCable() {
            let searchValue = document.getElementById("search").value.toLowerCase();
            let filteredCables = cables.filter(function(cable) {
                let regex = new RegExp([...searchValue].join('.*'), 'i');
                return regex.test(cable.type.toLowerCase());
            });
            displayFilteredCables(filteredCables);
        }

        function searchCable2() {
            let searchValue = document.getElementById("search").value.toUpperCase();
            let table = document.getElementById("cableTable");
            let trs = table.getElementsByTagName("tr");
            for (let i = 0; i < trs.length; i++) {
                let tdType = trs[i].getElementsByTagName("td")[0]; // GIO: Primeira coluna: tipo.
                let tdAddress = trs[i].getElementsByTagName("td")[2]; // GIO: Segunda coluna: endereco.

                if (tdType && tdAddress) { // GIO: Eu literalmente n sei pq precisa desse if, mas sem ele o codigo quebra. Coisas de html.
                    let txtValueType = tdType.textContent || tdType.innerText;  // GIO: Pegamos os valores das tds aqui, nao sei a diferenca de textContent pra innerText, mas meti logo os dois pra dale.
                    let txtValueAddress = tdAddress.textContent || tdAddress.innerText;

                 
                    let txtValueHasSearchValue = 
                        txtValueType.toUpperCase().indexOf(searchValue) > -1 || 
                        txtValueAddress.toUpperCase().indexOf(searchValue) > -1;

                    if (txtValueHasSearchValue) {
                        trs[i].style.display = "";
                    } else {
                        trs[i].style.display = "none";
                    } 
                }  
            }
        }

      
        function displayFilteredCables(filteredCables) {
            let table = document.getElementById("cableTable");
            table.innerHTML = `
                <tr>
                    <th>Tipo de Cabo</th>
                    <th>Tamanho do Cabo</th>
                    <th>cor</th>
                    <th>Ação</th>
                </tr>
            `;

            filteredCables.forEach(function(cable, index) {
                let row = table.insertRow(-1); 
                let cableTypeCell = row.insertCell(0);
                let cableSizeCell = row.insertCell(1);
                let shelfAddressCell = row.insertCell(2);
                let actionCell = row.insertCell(3);

                cableTypeCell.innerHTML = cable.type;
                cableSizeCell.innerHTML = cable.size;
                shelfAddressCell.innerHTML = cable.shelf;

                let editButton = document.createElement("button");
                editButton.innerHTML = "Editar";
                editButton.className = "button";
                editButton.addEventListener("click", function() {
                    editCable(index);
                });
                actionCell.appendChild(editButton);

                let deleteButton = document.createElement("button");
                deleteButton.innerHTML = "Excluir";
                deleteButton.className = "button";
                deleteButton.addEventListener("click", function() {
                    deleteCable(index);
                });
                actionCell.appendChild(deleteButton);
            });
        }

        // Função para salvar os cabos no armazenamento local
        function saveCables() {
            localStorage.setItem("cables", JSON.stringify(cables));
        }

        // Event listener para o formulário de adicionar cabo
        // document.getElementById("cableForm").addEventListener("submit", addCable);
        document.getElementById("cableForm").addEventListener("submit", addCable2);
    </script>
</body>
